<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SSD CW2</title>
    <!–– Created by Ryan Auld GCU Student ID S1511985––>
    <link rel="stylesheet" href="index.css">
    <style>
        th, td, p, input {
            font:14px Verdana;
        }
        table, th, td
        {
            border: solid 1px #DDD;
            border-collapse: collapse;
            padding: 2px 3px;
            text-align: center;
        }
        th {
            font-weight:bold;
        }
    </style>
</head>
<body onload="onload()">
HELLO
<p id="showData"></p>
</body>
<script>
    function onload() {

        /*       if (location.protocol !== 'https:')
        {
            location.href = 'https:' + window.location.href.substring(window.location.protocol.length);
        }*/
        const url = "../server/tablecreation.php";
        fetch(url, {
            method: 'GET'
        }).then(response => response.text()).then(data => {
            buildtable(data);
        //console.log(data)});
        //it outputs it as an array here try to sort this tomorrow.!!!!!!!!!!

    });

    function buildtable(input, classes){
        var txt = input;
        var pt = txt.replace("{\"adminjob\":[", "");
        pt = pt.replace("]}", "");
        var pts = pt.split("},{");
        document.write(pts[1]);
        for (var i = 0; i < pts.length; i++){
            pts[i] = pts[i].replace("{", "");
            pts[i] = pts[i].replace("}", "");
            //console.log(pts[i]);
        }
        var body = document.body,
            tbl  = document.createElement('table');
            tbl.style.width  = '75%';
            tbl.style.border = '3px solid black';
        var array = ["job","source","date","body", "enact"];
        var tr = tbl.insertRow();
        for(var j = 0; j < 5; j++){
            var td = tr.insertCell();
                td.appendChild(document.createTextNode(array[j]));
                td.style.border = '1px solid black';
        }
        for (var k = 0; k < pts.length; k++){
            var tr = tbl.insertRow();
            ptss = pts[k].split(",");
            for(var l = 0; l <= ptss.length; l++){
                if(l == ptss.length){
                    var btn = document.createElement('input');
                    btn.type = "button";
                    btn.className = "btn";
                    btn.value = "test";
                    //btn.onclick = (function(entry) {return function() {chooseUser(entry);}})(entry);
                    var td = tr.insertCell();
                    tr.appendChild(btn);
                } else{
                var x = ptss[l];
                console.log(x);
                var y = x.split(":")
                var td = tr.insertCell();
                td.appendChild(document.createTextNode(y[1]));
                td.style.border = '1px solid black'; }
            }

        }
/*                for(var i = 0; i < 3; i++){
            var tr = tbl.insertRow();
            for(var j = 0; j < 2; j++){
                var td = tr.insertCell();
                    td.appendChild(document.createTextNode('Cell'));
                    td.style.border = '1px solid black';
            }
            }*/

            body.appendChild(tbl);
        }
    }
</script>


</html>